import os
import angr
from angrutils import *


# 修改自testangr2.py
this_project_path = "C:/Users/Aiden/PycharmProjects/dissertation"

path = this_project_path + "/resit/templates/"
for filename in os.listdir(path):
    print(filename)
    proj = angr.Project(path + filename, load_options={"auto_load_libs": False})
    main = proj.loader.main_object.get_symbol("main")
    start_state = proj.factory.blank_state(addr=main.rebased_addr)
    cfg = proj.analyses.CFGEmulated(fail_fast=True, starts=[main.rebased_addr], initial_state=start_state)
    plot_cfg(cfg, this_project_path + "/resit/graphs/" + filename, asminst=True, remove_imports=True, remove_path_terminator=True)
